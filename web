<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anesthesia Math</title>
  <style>
    :root {
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --blue: #2563eb;
      --green: #16a34a;
      --red: #dc2626;
      --border: rgba(17, 24, 39, 0.10);
      --shadow: 0 10px 24px rgba(17, 24, 39, 0.08);
      --radius: 18px;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
    }

    .app {
      max-width: 560px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      position: sticky;
      top: 0;
      background: rgba(246,247,251,0.90);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 14px 16px;
      z-index: 5;
    }

    .nav {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .back-btn {
      display: none;
      appearance: none;
      border: 0;
      background: transparent;
      padding: 6px 10px;
      border-radius: 10px;
      color: var(--blue);
      font-weight: 600;
      cursor: pointer;
    }

    .title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.2px;
    }

    main {
      padding: 18px 16px 24px;
      flex: 1;
    }

    .hero {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }

    .hero-left h1 {
      margin: 0 0 6px;
      font-size: 24px;
      line-height: 1.15;
    }
    .hero-left p {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    .logo {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      background: linear-gradient(135deg, #93c5fd, #2563eb);
      box-shadow: var(--shadow);
      flex: 0 0 auto;
      display: grid;
      place-items: center;
      color: white;
      font-weight: 800;
    }

    /* Cards / list */
    .list {
      display: grid;
      gap: 12px;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }

    .cat-btn {
      width: 100%;
      text-align: left;
      border: 0;
      background: transparent;
      padding: 0;
      cursor: pointer;
    }

    .cat-title {
      font-size: 16px;
      font-weight: 700;
      margin: 0 0 4px;
    }

    .cat-sub {
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    /* Question view */
    .label {
      color: var(--muted);
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .question-text {
      font-size: 18px;
      line-height: 1.35;
      margin: 0 0 14px;
    }

    .input {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 12px 12px;
      font-size: 16px;
      outline: none;
      background: #fff;
    }

    .row {
      display: grid;
      gap: 10px;
      margin-top: 12px;
    }

    .btn {
      width: 100%;
      border: 0;
      border-radius: 14px;
      padding: 12px 14px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
    }

    .btn-primary { background: var(--blue); color: white; }
    .btn-secondary { background: rgba(17,24,39,0.08); color: var(--text); }

    .result {
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    .pill {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 13px;
    }
    .pill.ok { background: rgba(22,163,74,0.12); color: var(--green); }
    .pill.bad { background: rgba(220,38,38,0.12); color: var(--red); }

    .explain {
      margin-top: 10px;
      color: var(--text);
      line-height: 1.45;
      white-space: pre-wrap;
    }

    .muted {
      color: var(--muted);
      font-size: 14px;
      line-height: 1.45;
    }

    footer {
      padding: 10px 16px 18px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
    }

    /* Utility */
    .hidden { display: none !important; }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div class="nav">
        <button id="backBtn" class="back-btn" type="button">← Back</button>
        <div id="navTitle" class="title">Anesthesia Math App</div>
      </div>
    </header>

    <main>
      <!-- HOME VIEW -->
      <section id="homeView">
        <div class="hero">
          <div class="hero-left">
            <h1>Anesthesia Math</h1>
            <p>Pick a category. Answer → feedback → explanation → next random question.</p>
          </div>
          <!-- Optional “logo” placeholder: replace text with an <img> if you want -->
          <div class="logo" aria-label="App Logo">AM</div>
        </div>

        <div class="list">
          <div class="card">
            <button class="cat-btn" data-category="dilution" type="button">
              <p class="cat-title">Diluting Anesthesia Specific Medications</p>
              <p class="cat-sub">Concentration changes, dilutions, vial math</p>
            </button>
          </div>

          <div class="card">
            <button class="cat-btn" data-category="localAnesthetic" type="button">
              <p class="cat-title">Local Anesthetic Dosing</p>
              <p class="cat-sub">mg/kg limits, % → mg/mL conversions, total dose</p>
            </button>
          </div>

          <div class="card">
            <button class="cat-btn" data-category="mixingDrips" type="button">
              <p class="cat-title">Mixing Drips</p>
              <p class="cat-sub">Concentration, mg/hr, mL/hr infusion rate math</p>
            </button>
          </div>

          <div class="card">
            <button class="cat-btn" data-category="randomMath" type="button">
              <p class="cat-title">Random Anesthesia Math Questions</p>
              <p class="cat-sub">Grab-bag of common conversions and quick calcs</p>
            </button>
          </div>
        </div>
      </section>

      <!-- QUESTION VIEW -->
      <section id="questionView" class="hidden">
        <div class="card">
          <div class="label">Question</div>
          <p id="questionText" class="question-text"></p>

          <input id="answerInput" class="input" inputmode="decimal" placeholder="Enter your answer (number)" />

          <div class="row">
            <button id="submitBtn" class="btn btn-primary" type="button">Submit</button>
          </div>

          <div id="resultBlock" class="result hidden">
            <div id="resultPill" class="pill"></div>

            <div class="muted" style="margin-top:10px;">
              <strong>Explanation:</strong>
            </div>
            <div id="explanationText" class="explain"></div>

            <div class="row" style="margin-top:14px;">
              <button id="nextBtn" class="btn btn-secondary" type="button">Next Question</button>
            </div>
          </div>

          <div id="doneBlock" class="result hidden">
            <div class="pill ok">Done</div>
            <p class="muted" style="margin-top:10px;">
              You’ve answered all questions in this category (for this session).
              Go back to pick another category.
            </p>
          </div>
        </div>
      </section>
    </main>

    <footer>
      Educational tool only. Not medical advice. Always follow local policies and verify calculations clinically.
    </footer>
  </div>

  <script>
    // ----------------------------
    // Question Bank
    // ----------------------------
    const QUESTIONS = [
      // LOCAL ANESTHETIC (your 10)
      {
        id: 101,
        category: "localAnesthetic",
        questionText: "A patient weighing 70 kg requires Lidocaine at a dose of 3 mg/kg. How many milligrams of Lidocaine should you administer?",
        correctAnswer: "210",
        explanation: "Calculation:\n70 kg × 3 mg/kg = 210 mg"
      },
      {
        id: 102,
        category: "localAnesthetic",
        questionText: "Bupivacaine has a maximum recommended dose of 2.5 mg/kg. What is the maximum allowable dose for a 50 kg patient?",
        correctAnswer: "125",
        explanation: "Calculation:\n50 kg × 2.5 mg/kg = 125 mg"
      },
      {
        id: 103,
        category: "localAnesthetic",
        questionText: "Ropivacaine at 0.75% concentration is available. How many milligrams are present in 10 mL?",
        correctAnswer: "75",
        explanation: "0.75% means 0.75 g per 100 mL (750 mg per 100 mL).\nCalculation:\n750 mg ÷ 10 = 75 mg"
      },
      {
        id: 104,
        category: "localAnesthetic",
        questionText: "You administer 20 mL of Lidocaine 2% solution. How many milligrams of Lidocaine have you given?",
        correctAnswer: "400",
        explanation: "2% Lidocaine = 20 mg/mL\nCalculation:\n20 mg/mL × 20 mL = 400 mg"
      },
      {
        id: 105,
        category: "localAnesthetic",
        questionText: "A pediatric patient weighs 15 kg. The recommended dose of Lidocaine is 3 mg/kg. What is the total dose?",
        correctAnswer: "45",
        explanation: "Calculation:\n15 kg × 3 mg/kg = 45 mg"
      },
      {
        id: 106,
        category: "localAnesthetic",
        questionText: "A patient weighs 60 kg, and the maximum dose of Lidocaine without epinephrine is 4 mg/kg. How many mL of 1% Lidocaine can you safely administer?",
        correctAnswer: "24",
        explanation: "Maximum dose:\n60 kg × 4 mg/kg = 240 mg\n1% Lidocaine = 10 mg/mL\nCalculation:\n240 mg ÷ 10 mg/mL = 24 mL"
      },
      {
        id: 107,
        category: "localAnesthetic",
        questionText: "If you inject 30 mL of 0.25% Bupivacaine, how many milligrams have you administered?",
        correctAnswer: "75",
        explanation: "0.25% = 2.5 mg/mL\nCalculation:\n2.5 mg/mL × 30 mL = 75 mg"
      },
      {
        id: 108,
        category: "localAnesthetic",
        questionText: "A patient is given 15 mL of 0.5% Ropivacaine. How many milligrams were administered?",
        correctAnswer: "75",
        explanation: "0.5% = 5 mg/mL\nCalculation:\n5 mg/mL × 15 mL = 75 mg"
      },
      {
        id: 109,
        category: "localAnesthetic",
        questionText: "Prilocaine maximum dosage is 8 mg/kg. How much can safely be given to an 80 kg adult?",
        correctAnswer: "640",
        explanation: "Calculation:\n80 kg × 8 mg/kg = 640 mg"
      },
      {
        id: 110,
        category: "localAnesthetic",
        questionText: "You plan to administer 12 mL of Lidocaine 1.5%. How many total milligrams is this?",
        correctAnswer: "180",
        explanation: "1.5% = 15 mg/mL\nCalculation:\n15 mg/mL × 12 mL = 180 mg"
      },

      // OPTIONAL placeholders (so other categories aren't empty)
      {
        id: 201,
        category: "dilution",
        questionText: "You have 10 mL of a drug at 1 mg/mL and want 0.1 mg/mL. If you dilute to a total of 100 mL, how many mg are in the final bag?",
        correctAnswer: "10",
        explanation: "The amount of drug (mg) stays the same during dilution.\nStarting amount: 10 mL × 1 mg/mL = 10 mg.\nFinal bag still contains 10 mg total."
      },
      {
        id: 301,
        category: "mixingDrips",
        questionText: "You mix 500 mg in 1000 mL. What is the concentration (mg/mL)?",
        correctAnswer: "0.5",
        explanation: "Concentration = total mg ÷ total mL = 500 ÷ 1000 = 0.5 mg/mL."
      },
      {
        id: 401,
        category: "randomMath",
        questionText: "A set delivers 20 gtt/mL. If infusing 60 mL/hr, how many gtt/min?",
        correctAnswer: "20",
        explanation: "60 mL/hr = 1 mL/min.\n1 mL/min × 20 gtt/mL = 20 gtt/min."
      }
    ];

    const CATEGORY_LABELS = {
      dilution: "Diluting Anesthesia Specific Medications",
      localAnesthetic: "Local Anesthetic Dosing",
      mixingDrips: "Mixing Drips",
      randomMath: "Random Anesthesia Math Questions"
    };

    // ----------------------------
    // App State
    // ----------------------------
    const state = {
      currentCategory: null,
      remainingByCategory: new Map(), // category -> [questionIds remaining]
      currentQuestion: null,
      hasSubmitted: false
    };

    function initRemaining(category) {
      const ids = QUESTIONS
        .filter(q => q.category === category)
        .map(q => q.id);

      state.remainingByCategory.set(category, shuffle([...ids]));
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function getNextQuestion(category) {
      if (!state.remainingByCategory.has(category)) {
        initRemaining(category);
      }
      const remaining = state.remainingByCategory.get(category);
      if (!remaining || remaining.length === 0) return null;

      const nextId = remaining.pop(); // no repeats until exhausted
      return QUESTIONS.find(q => q.id === nextId) || null;
    }

    // Numeric comparison with tolerance (handles "0.5" vs "0.50")
    function answersMatch(userInput, correctAnswer) {
      const u = userInput.trim().replace(/,/g, "");
      const c = String(correctAnswer).trim().replace(/,/g, "");

      const uNum = Number(u);
      const cNum = Number(c);

      const uIsNum = !Number.isNaN(uNum) && u !== "";
      const cIsNum = !Number.isNaN(cNum) && c !== "";

      if (uIsNum && cIsNum) {
        const tol = 0.01;
        return Math.abs(uNum - cNum) <= tol;
      }
      return u.toLowerCase() === c.toLowerCase();
    }

    // ----------------------------
    // UI Wiring
    // ----------------------------
    const homeView = document.getElementById("homeView");
    const questionView = document.getElementById("questionView");
    const navTitle = document.getElementById("navTitle");
    const backBtn = document.getElementById("backBtn");

    const questionTextEl = document.getElementById("questionText");
    const answerInput = document.getElementById("answerInput");
    const submitBtn = document.getElementById("submitBtn");

    const resultBlock = document.getElementById("resultBlock");
    const resultPill = document.getElementById("resultPill");
    const explanationText = document.getElementById("explanationText");
    const nextBtn = document.getElementById("nextBtn");

    const doneBlock = document.getElementById("doneBlock");

    function showHome() {
      state.currentCategory = null;
      state.currentQuestion = null;
      state.hasSubmitted = false;

      navTitle.textContent = "Anesthesia Math App";
      backBtn.style.display = "none";

      homeView.classList.remove("hidden");
      questionView.classList.add("hidden");
    }

    function showCategory(category) {
      state.currentCategory = category;
      state.currentQuestion = getNextQuestion(category);
      state.hasSubmitted = false;

      navTitle.textContent = CATEGORY_LABELS[category] || "Questions";
      backBtn.style.display = "inline-block";

      homeView.classList.add("hidden");
      questionView.classList.remove("hidden");

      renderQuestion();
    }

    function renderQuestion() {
      // reset UI
      resultBlock.classList.add("hidden");
      doneBlock.classList.add("hidden");
      answerInput.value = "";
      answerInput.disabled = false;
      submitBtn.disabled = false;

      const q = state.currentQuestion;
      if (!q) {
        questionTextEl.textContent = "";
        doneBlock.classList.remove("hidden");
        return;
      }

      questionTextEl.textContent = q.questionText;
      // focus input for quick use
      setTimeout(() => answerInput.focus(), 50);
    }

    function submitAnswer() {
      const q = state.currentQuestion;
      if (!q) return;

      const user = answerInput.value;
      const correct = answersMatch(user, q.correctAnswer);

      resultPill.className = "pill " + (correct ? "ok" : "bad");
      resultPill.textContent = correct ? "Correct!" : "Incorrect!";
      explanationText.textContent = q.explanation;

      resultBlock.classList.remove("hidden");

      // lock input after submit
      answerInput.disabled = true;
      submitBtn.disabled = true;
      state.hasSubmitted = true;
    }

    function nextQuestion() {
      if (!state.currentCategory) return;

      state.currentQuestion = getNextQuestion(state.currentCategory);
      state.hasSubmitted = false;
      renderQuestion();
    }

    // Category click handlers
    document.querySelectorAll(".cat-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const cat = btn.getAttribute("data-category");
        showCategory(cat);
      });
    });

    backBtn.addEventListener("click", showHome);
    submitBtn.addEventListener("click", submitAnswer);
    nextBtn.addEventListener("click", nextQuestion);

    // Submit on Enter key
    answerInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !submitBtn.disabled) {
        submitAnswer();
      }
    });

    // Start
    showHome();
  </script>
</body>
</html>
